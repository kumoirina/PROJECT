<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æ³¢ä¹‰è€³å®šå¾‹æ•™å­¦å®éªŒ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
    }
    .output {
      font-size: 18px;
      margin-top: 20px;
    }
    .display-boxes {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .box {
      padding: 15px;
      background: #eef;
      border-radius: 8px;
      text-align: center;
      width: 28%;
      font-size: 20px;
      font-weight: bold;
    }
    .slider-section {
      margin-top: 20px;
    }
    .slider-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    input[type=range] {
      width: 100%;
    }
    canvas {
      margin-top: 30px;
    }
    .animation {
      margin-top: 30px;
      text-align: center;
    }
    .animation img {
      max-width: 100%;
      height: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    #simulationCanvas {
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #fff;
      margin: 20px auto;
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ”¬ æ³¢ä¹‰è€³å®šå¾‹æ•™å­¦å®éªŒæ¨¡æ‹Ÿ</h2>

    <div class="output">
      <p>ğŸ“Š ä»¥ä¸‹æ•°æ®æ¥è‡ª Nuffield Foundation çš„å®é™…å®éªŒï¼Œå±•ç¤ºåœ¨æ’å®šæ¸©åº¦ä¸‹ï¼Œå‹å¼ºä¸ä½“ç§¯çš„åæ¯”å…³ç³»ï¼š</p>
    </div>

    <div class="display-boxes">
      <div class="box" id="volumeDisplay">ä½“ç§¯ï¼š7.34 cmÂ³</div>
      <div class="box" id="pressureDisplay">å‹å¼ºï¼š100330 Pa</div>
      <div class="box" id="temperatureDisplay">æ¸©åº¦ï¼š300 K</div>
    </div>

    <div class="slider-section">
      <label for="volumeSlider">ğŸ”§ æ‹–åŠ¨ä»¥æ”¹å˜ä½“ç§¯:</label>
      <input type="range" id="volumeSlider" min="0" max="8" step="1">
    </div>

    <div class="slider-section">
      <label for="temperatureSlider">ğŸŒ¡ï¸ æ‹–åŠ¨ä»¥æ”¹å˜æ¸©åº¦:</label>
      <input type="range" id="temperatureSlider" min="200" max="400" step="1">
    </div>

    <canvas id="simulationCanvas" width="400" height="300"></canvas>

    <div class="animation">
      <h3>ğŸï¸ ç†æƒ³æ°”ä½“çŠ¶æ€æ–¹ç¨‹åŠ¨ç”»è§£é‡Š</h3>
      <img src="https://upload.wikimedia.org/wikipedia/commons/9/99/Kinetic_Theory_of_Gases.gif" alt="ç†æƒ³æ°”ä½“åŠ¨ç”»">
      <p>ç†æƒ³æ°”ä½“åˆ†å­åœ¨ä½“ç§¯å˜å°æ—¶å•ä½é¢ç§¯ç¢°æ’é¢‘ç‡å¢åŠ ï¼Œé€ æˆå‹å¼ºå‡é«˜ã€‚</p>
    </div>
  </div>

  <script>
    const volumeData = [7.34, 7.24, 7.14, 7.04, 6.89, 6.84, 6.79, 6.69, 6.64];
    const pressureData = [100330, 102200, 103930, 105270, 107400, 108470, 109400, 111140, 112200];
    const temperatureDefault = 300;

    const volumeDisplay = document.getElementById('volumeDisplay');
    const pressureDisplay = document.getElementById('pressureDisplay');
    const temperatureDisplay = document.getElementById('temperatureDisplay');
    const volumeSlider = document.getElementById('volumeSlider');
    const temperatureSlider = document.getElementById('temperatureSlider');
    const canvas = document.getElementById('simulationCanvas');
    const ctx = canvas.getContext('2d');

    // æ°”ä½“åˆ†å­æ¨¡æ‹Ÿ
    class Molecule {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        // é™ä½åŸºç¡€é€Ÿåº¦ï¼Œè®©æ¸©åº¦å˜åŒ–æ•ˆæœæ›´æ˜æ˜¾
        const baseSpeed = 1.5;
        const angle = Math.random() * Math.PI * 2;
        this.dx = Math.cos(angle) * baseSpeed;
        this.dy = Math.sin(angle) * baseSpeed;
        this.radius = 3;
        this.mass = 1;
      }

      // è®¡ç®—ä¸å¦ä¸€ä¸ªåˆ†å­çš„ç¢°æ’
      collideWith(other) {
        const dx = other.x - this.x;
        const dy = other.y - this.y;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < this.radius + other.radius) {
            // å®Œå…¨å¼¹æ€§ç¢°æ’çš„ç®€åŒ–å®ç°
            const angle = Math.atan2(dy, dx);
            
            // äº¤æ¢é€Ÿåº¦åˆ†é‡
            const speed1 = Math.sqrt(this.dx * this.dx + this.dy * this.dy);
            const speed2 = Math.sqrt(other.dx * other.dx + other.dy * other.dy);
            
            const direction1 = Math.atan2(this.dy, this.dx);
            const direction2 = Math.atan2(other.dy, other.dx);
            
            this.dx = speed2 * Math.cos(direction2);
            this.dy = speed2 * Math.sin(direction2);
            other.dx = speed1 * Math.cos(direction1);
            other.dy = speed1 * Math.sin(direction1);
            
            // é˜²æ­¢é‡å 
            const overlap = (this.radius + other.radius - distance) / 2;
            this.x -= Math.cos(angle) * overlap;
            this.y -= Math.sin(angle) * overlap;
            other.x += Math.cos(angle) * overlap;
            other.y += Math.sin(angle) * overlap;
        }
      }

      // ä¸å¢™å£çš„ç¢°æ’æ£€æµ‹å’Œå“åº”
      handleWallCollision(pistonHeight) {
        const nextX = this.x + this.dx;
        const nextY = this.y + this.dy;

        // å®Œå…¨å¼¹æ€§ç¢°æ’ï¼Œç§»é™¤èƒ½é‡æŸè€—ç³»æ•°
        if (nextX < 100 + this.radius) {
          this.x = 100 + this.radius;
          this.dx = Math.abs(this.dx); // ç§»é™¤ 0.99 ç³»æ•°
        } else if (nextX > 300 - this.radius) {
          this.x = 300 - this.radius;
          this.dx = -Math.abs(this.dx);
        }

        if (nextY < pistonHeight + this.radius) {
          this.y = pistonHeight + this.radius;
          this.dy = Math.abs(this.dy);
        } else if (nextY > 250 - this.radius) {
          this.y = 250 - this.radius;
          this.dy = -Math.abs(this.dy);
        }
      }

      update(pistonHeight, molecules) {
        // å¤„ç†ä¸å…¶ä»–åˆ†å­çš„ç¢°æ’
        molecules.forEach(other => {
          if (other !== this) {
            this.collideWith(other);
          }
        });

        // å¤„ç†ä¸å¢™å£çš„ç¢°æ’
        this.handleWallCollision(pistonHeight);

        // æ›´æ–°ä½ç½®ï¼Œç§»é™¤ç©ºæ°”é˜»åŠ›
        this.x += this.dx;
        this.y += this.dy;
        
        // ç§»é™¤åŸæœ‰çš„ç©ºæ°”é˜»åŠ›æ¨¡æ‹Ÿ
        // this.dx *= 0.999;
        // this.dy *= 0.999;
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = '#3498db';
        ctx.fill();
      }

      // æ·»åŠ é€Ÿåº¦ç¼©æ”¾æ–¹æ³•
      scaleVelocity(factor) {
        // æ‰©å¤§é€Ÿåº¦å˜åŒ–èŒƒå›´ï¼Œä½†ä¿æŒç‰©ç†åˆç†æ€§
        const currentSpeed = Math.sqrt(this.dx * this.dx + this.dy * this.dy);
        const newSpeed = Math.min(Math.max(currentSpeed * factor, 0.5), 8);
        const speedRatio = newSpeed / currentSpeed;
        
        this.dx *= speedRatio;
        this.dy *= speedRatio;
      }
    }

    // åˆ›å»ºåˆ†å­ - è°ƒæ•´åˆå§‹ä½ç½®èŒƒå›´
    const molecules = Array(50).fill().map(() => 
      new Molecule(
        Math.random() * 200 + 100,
        Math.random() * 150 + 100  // è°ƒæ•´åˆå§‹yåæ ‡èŒƒå›´
      )
    );

    function drawContainer(pistonHeight) {
      // ç»˜åˆ¶æ°”ç¼¸
      ctx.strokeStyle = '#2c3e50';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(100, 50);
      ctx.lineTo(100, 250);
      ctx.lineTo(300, 250);
      ctx.lineTo(300, 50);
      ctx.stroke();

      // ç»˜åˆ¶æ´»å¡ - ä»ä¸Šæ–¹å¾€ä¸‹å‹
      ctx.fillStyle = '#95a5a6';
      ctx.fillRect(95, pistonHeight, 210, 10);
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const volumeIndex = parseInt(volumeSlider.value);
      const pistonHeight = 50 + (volumeIndex * 25); // å¢å¤§æ´»å¡ç§»åŠ¨èŒƒå›´
      
      drawContainer(pistonHeight);
      
      // æ›´æ–°æ‰€æœ‰åˆ†å­
      molecules.forEach(molecule => {
        molecule.update(pistonHeight, molecules);
        molecule.draw();
      });
      
      requestAnimationFrame(animate);
    }

    function updateDisplays(volumeIndex, temperature) {
      const basePressure = pressureData[volumeIndex];
      const tempFactor = temperature / temperatureDefault;
      const adjustedPressure = Math.round(basePressure * tempFactor);
      volumeDisplay.innerText = `ä½“ç§¯ï¼š${volumeData[volumeIndex]} cmÂ³`;
      pressureDisplay.innerText = `å‹å¼ºï¼š${adjustedPressure} Pa`;
      temperatureDisplay.innerText = `æ¸©åº¦ï¼š${temperature} K`;
    }

    function handleInput() {
      const volumeIndex = parseInt(volumeSlider.value);
      const temperature = parseInt(temperatureSlider.value);
      const previousTemp = parseInt(temperatureDisplay.textContent.split('ï¼š')[1]);
      
      // å¢å¼ºæ¸©åº¦å¯¹é€Ÿåº¦çš„å½±å“
      const velocityScale = Math.pow(temperature / previousTemp, 1);
      
      molecules.forEach(molecule => {
        molecule.scaleVelocity(velocityScale);
      });
      
      updateDisplays(volumeIndex, temperature);
    }

    // Start animation
    animate();

    volumeSlider.addEventListener('input', handleInput);
    temperatureSlider.addEventListener('input', handleInput);

    updateDisplays(0, temperatureDefault);
  </script>
</body>
</html>
